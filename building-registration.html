<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‚Ù‚</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .loading { display: none; }
        .loading.show { display: inline-block; }
    </style>
</head>
<body class="bg-base-200">
    <!-- Header -->
    <div class="navbar bg-primary text-primary-content">
        <div class="flex-1">
            <h1 class="btn btn-ghost text-xl">ğŸ  ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‚Ù‚</h1>
        </div>
        <!-- <div class="flex-none">
            <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost">
                    ğŸ“‹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
                </label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a onclick="showApartmentsList()">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ù‚Ù‚ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</a></li>
                    <li><a onclick="refreshData()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a></li>
                </ul>
            </div>
            <div class="loading loading-spinner loading-sm" id="loading-indicator"></div>
        </div> -->
    </div>

    <div class="container mx-auto p-4 max-w-6xl">
        <!-- Database Status -->
        <div id="db-status" class="alert mb-4" style="display: none;">
            <span id="db-status-message"></span>
        </div>

        <!-- Status Alert -->
        <div id="status-alert" class="alert mb-4" style="display: none;">
            <span id="status-message"></span>
        </div>

        <!-- Setup Instructions (shown if database not configured) -->
        <div id="setup-instructions" class="alert alert-info mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <div>
                <h3 class="font-bold">Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</h3>
                <p>1. Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠ ÙÙŠ Supabase</p>
                <p>2. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ ÙˆØ¬Ø¯ÙˆÙ„ "apartments" Ø¨Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
                <p>3. Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø£Ø¯Ù†Ø§Ù‡</p>
                <button class="btn btn-sm mt-2" onclick="showDatabaseConfig()">Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>

        <!-- Database Configuration Modal -->
        <div id="db-config-modal" class="modal">
            <div class="modal-box">
                <h3 class="font-bold text-lg">Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                <div class="py-4">
                    <div class="form-control mb-4">
                        <label class="label">Supabase URL:</label>
                        <input type="text" id="supabase-url" class="input input-bordered" placeholder="https://your-project.supabase.co">
                    </div>
                    <div class="form-control mb-4">
                        <label class="label">Supabase Anon Key:</label>
                        <input type="text" id="supabase-key" class="input input-bordered" placeholder="your-anon-key">
                    </div>
                    <div class="alert alert-warning text-sm">
                        <p>Ø§Ø­ÙØ¸ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø¦Ù…</p>
                    </div>
                </div>
                <div class="modal-action">
                    <button class="btn" onclick="closeDbConfig()">Ø¥Ù„ØºØ§Ø¡</button>
                    <button class="btn btn-primary" onclick="testConnection()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
                </div>
            </div>
        </div>

        <!-- Apartment Registration Form -->
        <div id="registration-form" class="card bg-base-100 shadow-xl mb-6 fade-in">
            <div class="card-body">
                <h2 class="card-title text-2xl mb-4">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ù‚Ø©</h2>
                <form id="apartment-form" class="space-y-6">
                    <!-- Apartment Selection -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">Ø§Ù„Ø·Ø§Ø¨Ù‚ *</span>
                            </label>
                            <select name="floor" class="select select-bordered" required onchange="updateApartmentId()">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ø¨Ù‚</option>
                                <option value="Ø£Ø±Ø¶ÙŠ">Ø£Ø±Ø¶ÙŠ</option>
                                <option value="Ø£ÙˆÙ„">Ø£ÙˆÙ„</option>
                                <option value="Ø«Ø§Ù†ÙŠ">Ø«Ø§Ù†ÙŠ</option>
                                <option value="Ø«Ø§Ù„Ø«">Ø«Ø§Ù„Ø«</option>
                                <option value="Ø±Ø§Ø¨Ø¹">Ø±Ø§Ø¨Ø¹</option>
                                <option value="Ø®Ø§Ù…Ø³">Ø®Ø§Ù…Ø³</option>
                            </select>
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">Ø±Ù‚Ù… Ø§Ù„Ø´Ù‚Ø© *</span>
                            </label>
                            <select name="apartment" class="select select-bordered" required onchange="updateApartmentId()">
                                <option value="">Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ø´Ù‚Ø©</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                    </div>

                    <!-- Apartment ID Display -->
                    <div class="alert alert-info">
                        <span>Ù…Ø¹Ø±Ù Ø§Ù„Ø´Ù‚Ø©: <strong id="apartment-id">Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</strong></span>
                        <span id="existing-indicator" style="display: none;" class="badge badge-warning">Ù…Ø³Ø¬Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹</span>
                    </div>

                    <!-- Owner/Tenant Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ/Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± *</span>
                            </label>
                            <input type="text" name="resident_name" class="input input-bordered" required 
                                   placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">Ø§Ù„Ù„Ù‚Ø¨/Ø§Ù„Ù…Ù‡Ù†Ø©</span>
                            </label>
                            <input type="text" name="title" class="input input-bordered" 
                                   placeholder="Ù…Ø«Ø§Ù„: Ø¯ÙƒØªÙˆØ±ØŒ Ù…Ù‡Ù†Ø¯Ø³ØŒ Ø£Ø³ØªØ§Ø°">
                        </div>
                    </div>

                    <!-- Residence Type -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© *</span>
                        </label>
                        <select name="residence_type" class="select select-bordered" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                            <option value="Ù…Ø§Ù„Ùƒ">Ù…Ø§Ù„Ùƒ</option>
                            <option value="Ù…Ø³ØªØ£Ø¬Ø±">Ù…Ø³ØªØ£Ø¬Ø±</option>
                        </select>
                    </div>

                    <!-- Contact Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ *</span>
                            </label>
                            <input type="tel" name="primary_phone" class="input input-bordered" required 
                                   placeholder="01xxxxxxxxx">
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ø­ØªÙŠØ§Ø·ÙŠ</span>
                            </label>
                            <input type="tel" name="secondary_phone" class="input input-bordered" 
                                   placeholder="01xxxxxxxxx">
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>
                        </label>
                        <input type="email" name="email" class="input input-bordered" 
                               placeholder="example@email.com">
                    </div>

                    <!-- Family Information -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">Ø¹Ø¯Ø¯ Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø±Ø©</span>
                            </label>
                            <input type="number" name="family_members" class="input input-bordered" 
                                   min="1" max="20" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙØ±Ø§Ø¯">
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„</span>
                            </label>
                            <input type="number" name="children_count" class="input input-bordered" 
                                   min="0" max="15" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„">
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</span>
                            </label>
                            <input type="date" name="move_in_date" class="input input-bordered">
                        </div>
                    </div>

                    <!-- Emergency Contact -->
                    <div class="divider">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">Ø§Ø³Ù… Ø´Ø®Øµ Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‡</span>
                            </label>
                            <input type="text" name="emergency_contact_name" class="input input-bordered" 
                                   placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ">
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</span>
                            </label>
                            <input type="tel" name="emergency_contact_phone" class="input input-bordered" 
                                   placeholder="01xxxxxxxxx">
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</span>
                        </label>
                        <textarea name="notes" class="textarea textarea-bordered" rows="3" 
                                  placeholder="Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù‡Ù…Ø©..."></textarea>
                    </div>

                    <!-- Submit Button -->
                    <div class="form-control">
                        <button type="submit" class="btn btn-primary btn-lg" id="submit-btn">
                            âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Apartments List -->
        <div id="apartments-list" class="card bg-base-100 shadow-xl" style="display: none;">
            <div class="card-body">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="card-title text-2xl">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ù‚Ù‚ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h2>
                    <div class="flex gap-2">
                        <button class="btn btn-outline btn-sm" onclick="refreshData()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
                        <button class="btn btn-outline" onclick="showRegistrationForm()">â• ØªØ³Ø¬ÙŠÙ„ Ø´Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="stats shadow mb-4">
                    <div class="stat">
                        <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‚Ù‚</div>
                        <div class="stat-value" id="total-apartments">18</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</div>
                        <div class="stat-value text-success" id="registered-apartments">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">ØºÙŠØ± Ù…Ø³Ø¬Ù„Ø©</div>
                        <div class="stat-value text-warning" id="unregistered-apartments">18</div>
                    </div>
                </div>
                
                <!-- Filter Controls -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="form-control">
                        <select class="select select-bordered" onchange="filterApartments()" id="floor-filter">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·ÙˆØ§Ø¨Ù‚</option>
                            <option value="Ø£Ø±Ø¶ÙŠ">Ø£Ø±Ø¶ÙŠ</option>
                            <option value="Ø£ÙˆÙ„">Ø£ÙˆÙ„</option>
                            <option value="Ø«Ø§Ù†ÙŠ">Ø«Ø§Ù†ÙŠ</option>
                            <option value="Ø«Ø§Ù„Ø«">Ø«Ø§Ù„Ø«</option>
                            <option value="Ø±Ø§Ø¨Ø¹">Ø±Ø§Ø¨Ø¹</option>
                            <option value="Ø®Ø§Ù…Ø³">Ø®Ø§Ù…Ø³</option>
                        </select>
                    </div>
                    <div class="form-control">
                        <select class="select select-bordered" onchange="filterApartments()" id="type-filter">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                            <option value="Ù…Ø§Ù„Ùƒ">Ù…Ù„Ø§Ùƒ ÙÙ‚Ø·</option>
                            <option value="Ù…Ø³ØªØ£Ø¬Ø±">Ù…Ø³ØªØ£Ø¬Ø±ÙŠÙ† ÙÙ‚Ø·</option>
                            <option value="empty">ØºÙŠØ± Ù…Ø³Ø¬Ù„Ø©</option>
                        </select>
                    </div>
                </div>
                
                <div id="apartments-container">
                    <!-- Apartments will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration - REPLACE WITH YOUR OWN VALUES
        const SUPABASE_URL = 'https://thzdemummlfqsutzxvke.supabase.co'; // Replace with your Supabase URL
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRoemRlbXVtbWxmcXN1dHp4dmtlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMTkwODIsImV4cCI6MjA3MjU5NTA4Mn0.0PUZlwuXW5mURyXbN3QZmaVY_sajNQ1s6CSHOSRL3a4'; // Replace with your anon key
        
        let supabase;
        let apartmentsData = [];

        // Floor mapping for apartment ID generation
        const floorMapping = {
            'Ø£Ø±Ø¶ÙŠ': 0, 'Ø£ÙˆÙ„': 1, 'Ø«Ø§Ù†ÙŠ': 2, 
            'Ø«Ø§Ù„Ø«': 3, 'Ø±Ø§Ø¨Ø¹': 4, 'Ø®Ø§Ù…Ø³': 5
        };

        // Initialize Supabase client
        function initSupabase() {
            try {
                if (SUPABASE_URL === 'YOUR_SUPABASE_URL' || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY') {
                    showDbStatus('ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
                    return false;
                }
                
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                //showDbStatus('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
                return true;
            } catch (error) {
                showDbStatus('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
                return false;
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (initSupabase()) {
                loadApartments();
                document.getElementById('setup-instructions').style.display = 'none';
            }
        });

        // Show database status
        function showDbStatus(message, type = 'info') {
            const alert = document.getElementById('db-status');
            const messageEl = document.getElementById('db-status-message');
            
            alert.className = `alert alert-${type} mb-4`;
            messageEl.textContent = message;
            alert.style.display = 'block';
        }

        // Show status message
        function showStatus(message, type = 'info') {
            const alert = document.getElementById('status-alert');
            const messageEl = document.getElementById('status-message');
            
            alert.className = `alert alert-${type} mb-4`;
            messageEl.textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // Show loading indicator
        function showLoading(show = true) {
            const loading = document.getElementById('loading-indicator');
            loading.classList.toggle('show', show);
        }

        // Database configuration modal functions
        function showDatabaseConfig() {
            document.getElementById('db-config-modal').classList.add('modal-open');
        }

        function closeDbConfig() {
            document.getElementById('db-config-modal').classList.remove('modal-open');
        }

        function testConnection() {
            const url = document.getElementById('supabase-url').value;
            const key = document.getElementById('supabase-key').value;
            
            if (!url || !key) {
                showStatus('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                return;
            }

            try {
                const testClient = window.supabase.createClient(url, key);
                showStatus('ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­! ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
                closeDbConfig();
            } catch (error) {
                showStatus('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message, 'error');
            }
        }

        // Load apartments from Supabase
        async function loadApartments() {
            if (!supabase) return;
            
            showLoading(true);
            try {
                const { data, error } = await supabase
                    .from('apartments')
                    .select('*')
                    .order('apartment_id');

                if (error) throw error;
                
                apartmentsData = data || [];
                updateStats();
                //showStatus('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                showStatus('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Save apartment to Supabase
        async function saveApartment(apartmentData) {
            if (!supabase) return false;
            
            showLoading(true);
            try {
                // Check if apartment exists
                const { data: existing } = await supabase
                    .from('apartments')
                    .select('id')
                    .eq('apartment_id', apartmentData.apartment_id)
                    .single();

                let result;
                if (existing) {
                    // Update existing apartment
                    result = await supabase
                        .from('apartments')
                        .update(apartmentData)
                        .eq('apartment_id', apartmentData.apartment_id);
                } else {
                    // Insert new apartment
                    result = await supabase
                        .from('apartments')
                        .insert([apartmentData]);
                }

                if (result.error) throw result.error;
                
                await loadApartments(); // Reload data
                return true;
            } catch (error) {
                showStatus('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
                return false;
            } finally {
                showLoading(false);
            }
        }

        // Delete apartment from Supabase
        async function deleteApartment(apartmentId) {
            if (!supabase) return;
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‚Ø©ØŸ')) return;
            
            showLoading(true);
            try {
                const { error } = await supabase
                    .from('apartments')
                    .delete()
                    .eq('apartment_id', apartmentId);

                if (error) throw error;
                
                await loadApartments(); // Reload data
                showStatus('ØªÙ… Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‚Ø©', 'success');
            } catch (error) {
                showStatus('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Refresh data from database
        async function refreshData() {
            await loadApartments();
            if (document.getElementById('apartments-list').style.display !== 'none') {
                displayApartments();
            }
        }

        // Update apartment ID and check if exists
        async function updateApartmentId() {
            const floor = document.querySelector('select[name="floor"]').value;
            const apartment = document.querySelector('select[name="apartment"]').value;
            const display = document.getElementById('apartment-id');
            const existingIndicator = document.getElementById('existing-indicator');
            
            if (floor && apartment) {
                const floorIndex = floorMapping[floor];
                const apartmentId = `${floorIndex}-${apartment}`;
                display.textContent = apartmentId;
                
                // Check if apartment exists in loaded data
                const existing = apartmentsData.find(apt => apt.apartment_id === apartmentId);
                if (existing) {
                    existingIndicator.style.display = 'inline';
                    prefillForm(existing);
                } else {
                    existingIndicator.style.display = 'none';
                    clearForm();
                }
            } else {
                display.textContent = 'Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹';
                existingIndicator.style.display = 'none';
                clearForm();
            }
        }

        // Pre-fill form with existing data
        function prefillForm(data) {
            const form = document.getElementById('apartment-form');
            Object.keys(data).forEach(key => {
                const input = form.querySelector(`[name="${key}"]`);
                if (input && data[key]) {
                    input.value = data[key];
                }
            });
        }

        // Clear form (except apartment selection)
        function clearForm() {
            const form = document.getElementById('apartment-form');
            const inputs = form.querySelectorAll('input:not([name="floor"]):not([name="apartment"]), textarea, select:not([name="floor"]):not([name="apartment"])');
            inputs.forEach(input => {
                if (input.name !== 'floor' && input.name !== 'apartment') {
                    input.value = '';
                }
            });
        }

        // Handle form submission
        document.getElementById('apartment-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            if (!supabase) {
                showStatus('ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                return;
            }
            
            const formData = new FormData(event.target);
            const floor = formData.get('floor');
            const apartment = formData.get('apartment');
            
            if (!floor || !apartment) {
                showStatus('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø§Ø¨Ù‚ ÙˆØ±Ù‚Ù… Ø§Ù„Ø´Ù‚Ø©', 'error');
                return;
            }

            const floorIndex = floorMapping[floor];
            const apartmentId = `${floorIndex}-${apartment}`;

            // Create apartment data object
            const apartmentData = {
                apartment_id: apartmentId,
                floor: floor,
                apartment_number: apartment,
                resident_name: formData.get('resident_name'),
                title: formData.get('title'),
                residence_type: formData.get('residence_type'),
                primary_phone: formData.get('primary_phone'),
                secondary_phone: formData.get('secondary_phone'),
                email: formData.get('email'),
                family_members: parseInt(formData.get('family_members')) || null,
                children_count: parseInt(formData.get('children_count')) || null,
                move_in_date: formData.get('move_in_date') || null,
                emergency_contact_name: formData.get('emergency_contact_name'),
                emergency_contact_phone: formData.get('emergency_contact_phone'),
                notes: formData.get('notes'),
                registration_date: new Date().toISOString().split('T')[0],
                last_updated: new Date().toISOString()
            };

            const success = await saveApartment(apartmentData);
            
            if (success) {
                const isUpdate = document.getElementById('existing-indicator').style.display === 'inline';
                showStatus(isUpdate ? 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                // Reset form
                event.target.reset();
                document.getElementById('apartment-id').textContent = 'Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹';
                document.getElementById('existing-indicator').style.display = 'none';
            }
        });

        // Update statistics
        function updateStats() {
            const totalApartments = 18; // 6 floors Ã— 3 apartments
            const registeredCount = apartmentsData.length;
            const unregisteredCount = totalApartments - registeredCount;
            
            document.getElementById('total-apartments').textContent = totalApartments;
            document.getElementById('registered-apartments').textContent = registeredCount;
            document.getElementById('unregistered-apartments').textContent = unregisteredCount;
        }

        // Show different sections
        function showRegistrationForm() {
            document.getElementById('registration-form').style.display = 'block';
            document.getElementById('apartments-list').style.display = 'none';
        }

        function showApartmentsList() {
            document.getElementById('registration-form').style.display = 'none';
            document.getElementById('apartments-list').style.display = 'block';
            displayApartments();
        }

        // Display apartments
        function displayApartments() {
            const container = document.getElementById('apartments-container');
            const floorFilter = document.getElementById('floor-filter').value;
            const typeFilter = document.getElementById('type-filter').value;
            
            let html = '';
            
            // Generate all possible apartments
            const floors = ['Ø£Ø±Ø¶ÙŠ', 'Ø£ÙˆÙ„', 'Ø«Ø§Ù†ÙŠ', 'Ø«Ø§Ù„Ø«', 'Ø±Ø§Ø¨Ø¹', 'Ø®Ø§Ù…Ø³'];
            const apartments = [1, 2, 3];
            
            floors.forEach((floor, floorIndex) => {
                apartments.forEach(aptNum => {
                    const apartmentId = `${floorIndex}-${aptNum}`;
                    const apartment = apartmentsData.find(apt => apt.apartment_id === apartmentId);
                    const isEmpty = !apartment;
                    
                    // Apply filters
                    if (floorFilter && floor !== floorFilter) return;
                    if (typeFilter === 'empty' && !isEmpty) return;
                    if (typeFilter && typeFilter !== 'empty' && (isEmpty || apartment.residence_type !== typeFilter)) return;
                    
                    if (isEmpty) {
                        html += `
                            <div class="card bg-base-200 shadow-md mb-4 opacity-60">
                                <div class="card-body">
                                    <h3 class="font-bold text-lg">${floor} - Ø´Ù‚Ø© ${aptNum}</h3>
                                    <p class="text-gray-500">ØºÙŠØ± Ù…Ø³Ø¬Ù„Ø©</p>
                                    <div class="badge badge-warning">ÙØ§Ø±ØºØ©</div>
                                </div>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="card bg-base-200 shadow-md mb-4">
                                <div class="card-body">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                        <div>
                                            <h3 class="font-bold text-lg">${apartment.floor} - Ø´Ù‚Ø© ${apartment.apartment_number}</h3>
                                            <p class="text-sm"><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${apartment.title ? apartment.title + ' ' : ''}${apartment.resident_name}</p>
                                            <p class="text-sm"><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> 
                                                <span class="badge ${apartment.residence_type === 'Ù…Ø§Ù„Ùƒ' ? 'badge-success' : 'badge-info'}">${apartment.residence_type}</span>
                                            </p>
                                            <p class="text-sm"><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${apartment.primary_phone}</p>
                                            ${apartment.email ? `<p class="text-sm"><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${apartment.email}</p>` : ''}
                                        </div>
                                        <div>
                                            <p class="text-sm"><strong>Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø±Ø©:</strong> ${apartment.family_members || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                            <p class="text-sm"><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„:</strong> ${apartment.children_count || 0}</p>
                                            ${apartment.move_in_date ? `<p class="text-sm"><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø³ÙƒÙ†:</strong> ${apartment.move_in_date}</p>` : ''}
                                            <p class="text-sm"><strong>Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> ${apartment.registration_date}</p>
                                            ${apartment.notes ? `<p class="text-sm"><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${apartment.notes}</p>` : ''}
                                        </div>
                                    </div>
                                    
                                    <div class="card-actions justify-end mt-4">
                                        <button class="btn btn-sm btn-outline btn-error" onclick="deleteApartment('${apartmentId}')">
                                            ğŸ—‘ï¸ Ø­Ø°Ù
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
            });
            
            container.innerHTML = html || '<div class="alert"><span>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ù‚Ù‚ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø±Ø´Ø­</span></div>';
        }

        // Filter apartments
        function filterApartments() {
            displayApartments();
        }
    </script>

    <!-- Supabase Table Creation SQL -->
    <script type="text/plain" id="sql-schema">
        -- SQL to create the apartments table in Supabase
        -- Run this in your Supabase SQL editor
        
        CREATE TABLE apartments (
            id SERIAL PRIMARY KEY,
            apartment_id TEXT UNIQUE NOT NULL,
            floor TEXT NOT NULL,
            apartment_number TEXT NOT NULL,
            resident_name TEXT NOT NULL,
            title TEXT,
            residence_type TEXT NOT NULL,
            primary_phone TEXT NOT NULL,
            secondary_phone TEXT,
            email TEXT,
            family_members INTEGER,
            children_count INTEGER,
            move_in_date DATE,
            emergency_contact_name TEXT,
            emergency_contact_phone TEXT,
            notes TEXT,
            registration_date DATE DEFAULT CURRENT_DATE,
            last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        );

        -- Create RLS policies (optional, for security)
        ALTER TABLE apartments ENABLE ROW LEVEL SECURITY;
        
        -- Allow public read access
        CREATE POLICY "Allow public read" ON apartments FOR SELECT USING (true);
        
        -- Allow public insert/update (you might want to restrict this)
        CREATE POLICY "Allow public insert" ON apartments FOR INSERT WITH CHECK (true);
        CREATE POLICY "Allow public update" ON apartments FOR UPDATE USING (true);
        CREATE POLICY "Allow public delete" ON apartments FOR DELETE USING (true);
    </script>
</body>
</html>