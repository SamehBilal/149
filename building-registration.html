<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل بيانات الشقق</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .loading { display: none; }
        .loading.show { display: inline-block; }
    </style>
</head>
<body class="bg-base-200">
    <!-- Header -->
    <div class="navbar bg-primary text-primary-content">
        <div class="flex-1">
            <h1 class="btn btn-ghost text-xl">🏠 تسجيل بيانات الشقق</h1>
        </div>
        <!-- <div class="flex-none">
            <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost">
                    📋 القوائم
                </label>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a onclick="showApartmentsList()">قائمة الشقق المسجلة</a></li>
                    <li><a onclick="refreshData()">تحديث البيانات</a></li>
                </ul>
            </div>
            <div class="loading loading-spinner loading-sm" id="loading-indicator"></div>
        </div> -->
    </div>

    <div class="container mx-auto p-4 max-w-6xl">
        <!-- Database Status -->
        <div id="db-status" class="alert mb-4" style="display: none;">
            <span id="db-status-message"></span>
        </div>

        <!-- Status Alert -->
        <div id="status-alert" class="alert mb-4" style="display: none;">
            <span id="status-message"></span>
        </div>

        <!-- Setup Instructions (shown if database not configured) -->
        <div id="setup-instructions" class="alert alert-info mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <div>
                <h3 class="font-bold">إعداد قاعدة البيانات:</h3>
                <p>1. إنشاء حساب مجاني في Supabase</p>
                <p>2. إنشاء مشروع جديد وجدول "apartments" بالأعمدة المطلوبة</p>
                <p>3. إدخال بيانات الاتصال في الكود أدناه</p>
                <button class="btn btn-sm mt-2" onclick="showDatabaseConfig()">إعداد قاعدة البيانات</button>
            </div>
        </div>

        <!-- Database Configuration Modal -->
        <div id="db-config-modal" class="modal">
            <div class="modal-box">
                <h3 class="font-bold text-lg">إعداد قاعدة البيانات</h3>
                <div class="py-4">
                    <div class="form-control mb-4">
                        <label class="label">Supabase URL:</label>
                        <input type="text" id="supabase-url" class="input input-bordered" placeholder="https://your-project.supabase.co">
                    </div>
                    <div class="form-control mb-4">
                        <label class="label">Supabase Anon Key:</label>
                        <input type="text" id="supabase-key" class="input input-bordered" placeholder="your-anon-key">
                    </div>
                    <div class="alert alert-warning text-sm">
                        <p>احفظ هذه البيانات في الكود للاستخدام الدائم</p>
                    </div>
                </div>
                <div class="modal-action">
                    <button class="btn" onclick="closeDbConfig()">إلغاء</button>
                    <button class="btn btn-primary" onclick="testConnection()">اختبار الاتصال</button>
                </div>
            </div>
        </div>

        <!-- Apartment Registration Form -->
        <div id="registration-form" class="card bg-base-100 shadow-xl mb-6 fade-in">
            <div class="card-body">
                <h2 class="card-title text-2xl mb-4">📝 تسجيل بيانات شقة</h2>
                <form id="apartment-form" class="space-y-6">
                    <!-- Apartment Selection -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">الطابق *</span>
                            </label>
                            <select name="floor" class="select select-bordered" required onchange="updateApartmentId()">
                                <option value="">اختر الطابق</option>
                                <option value="أرضي">أرضي</option>
                                <option value="أول">أول</option>
                                <option value="ثاني">ثاني</option>
                                <option value="ثالث">ثالث</option>
                                <option value="رابع">رابع</option>
                                <option value="خامس">خامس</option>
                            </select>
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">رقم الشقة *</span>
                            </label>
                            <select name="apartment" class="select select-bordered" required onchange="updateApartmentId()">
                                <option value="">اختر رقم الشقة</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                    </div>

                    <!-- Apartment ID Display -->
                    <div class="alert alert-info">
                        <span>معرف الشقة: <strong id="apartment-id">سيتم تحديده تلقائياً</strong></span>
                        <span id="existing-indicator" style="display: none;" class="badge badge-warning">مسجلة مسبقاً</span>
                    </div>

                    <!-- Owner/Tenant Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">اسم المالك/المستأجر *</span>
                            </label>
                            <input type="text" name="resident_name" class="input input-bordered" required 
                                   placeholder="الاسم الكامل">
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">اللقب/المهنة</span>
                            </label>
                            <input type="text" name="title" class="input input-bordered" 
                                   placeholder="مثال: دكتور، مهندس، أستاذ">
                        </div>
                    </div>

                    <!-- Residence Type -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">نوع الإقامة *</span>
                        </label>
                        <select name="residence_type" class="select select-bordered" required>
                            <option value="">اختر النوع</option>
                            <option value="مالك">مالك</option>
                            <option value="مستأجر">مستأجر</option>
                        </select>
                    </div>

                    <!-- Contact Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">رقم الهاتف الأساسي *</span>
                            </label>
                            <input type="tel" name="primary_phone" class="input input-bordered" required 
                                   placeholder="01xxxxxxxxx">
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">رقم هاتف احتياطي</span>
                            </label>
                            <input type="tel" name="secondary_phone" class="input input-bordered" 
                                   placeholder="01xxxxxxxxx">
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">البريد الإلكتروني</span>
                        </label>
                        <input type="email" name="email" class="input input-bordered" 
                               placeholder="example@email.com">
                    </div>

                    <!-- Family Information -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">عدد أفراد الأسرة</span>
                            </label>
                            <input type="number" name="family_members" class="input input-bordered" 
                                   min="1" max="20" placeholder="عدد الأفراد">
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">عدد الأطفال</span>
                            </label>
                            <input type="number" name="children_count" class="input input-bordered" 
                                   min="0" max="15" placeholder="عدد الأطفال">
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">تاريخ بداية الإقامة</span>
                            </label>
                            <input type="date" name="move_in_date" class="input input-bordered">
                        </div>
                    </div>

                    <!-- Emergency Contact -->
                    <div class="divider">بيانات الاتصال في حالات الطوارئ</div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">اسم شخص للاتصال به</span>
                            </label>
                            <input type="text" name="emergency_contact_name" class="input input-bordered" 
                                   placeholder="اسم الشخص">
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">رقم هاتف الطوارئ</span>
                            </label>
                            <input type="tel" name="emergency_contact_phone" class="input input-bordered" 
                                   placeholder="01xxxxxxxxx">
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">ملاحظات إضافية</span>
                        </label>
                        <textarea name="notes" class="textarea textarea-bordered" rows="3" 
                                  placeholder="أي معلومات إضافية مهمة..."></textarea>
                    </div>

                    <!-- Submit Button -->
                    <div class="form-control">
                        <button type="submit" class="btn btn-primary btn-lg" id="submit-btn">
                            ✅ تسجيل البيانات
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Apartments List -->
        <div id="apartments-list" class="card bg-base-100 shadow-xl" style="display: none;">
            <div class="card-body">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="card-title text-2xl">📋 قائمة الشقق المسجلة</h2>
                    <div class="flex gap-2">
                        <button class="btn btn-outline btn-sm" onclick="refreshData()">🔄 تحديث</button>
                        <button class="btn btn-outline" onclick="showRegistrationForm()">➕ تسجيل شقة جديدة</button>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="stats shadow mb-4">
                    <div class="stat">
                        <div class="stat-title">إجمالي الشقق</div>
                        <div class="stat-value" id="total-apartments">18</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">المسجلة</div>
                        <div class="stat-value text-success" id="registered-apartments">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">غير مسجلة</div>
                        <div class="stat-value text-warning" id="unregistered-apartments">18</div>
                    </div>
                </div>
                
                <!-- Filter Controls -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="form-control">
                        <select class="select select-bordered" onchange="filterApartments()" id="floor-filter">
                            <option value="">جميع الطوابق</option>
                            <option value="أرضي">أرضي</option>
                            <option value="أول">أول</option>
                            <option value="ثاني">ثاني</option>
                            <option value="ثالث">ثالث</option>
                            <option value="رابع">رابع</option>
                            <option value="خامس">خامس</option>
                        </select>
                    </div>
                    <div class="form-control">
                        <select class="select select-bordered" onchange="filterApartments()" id="type-filter">
                            <option value="">جميع الأنواع</option>
                            <option value="مالك">ملاك فقط</option>
                            <option value="مستأجر">مستأجرين فقط</option>
                            <option value="empty">غير مسجلة</option>
                        </select>
                    </div>
                </div>
                
                <div id="apartments-container">
                    <!-- Apartments will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration - REPLACE WITH YOUR OWN VALUES
        const SUPABASE_URL = 'https://thzdemummlfqsutzxvke.supabase.co'; // Replace with your Supabase URL
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRoemRlbXVtbWxmcXN1dHp4dmtlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMTkwODIsImV4cCI6MjA3MjU5NTA4Mn0.0PUZlwuXW5mURyXbN3QZmaVY_sajNQ1s6CSHOSRL3a4'; // Replace with your anon key
        
        let supabase;
        let apartmentsData = [];

        // Floor mapping for apartment ID generation
        const floorMapping = {
            'أرضي': 0, 'أول': 1, 'ثاني': 2, 
            'ثالث': 3, 'رابع': 4, 'خامس': 5
        };

        // Initialize Supabase client
        function initSupabase() {
            try {
                if (SUPABASE_URL === 'YOUR_SUPABASE_URL' || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY') {
                    showDbStatus('يرجى إعداد بيانات الاتصال بقاعدة البيانات', 'warning');
                    return false;
                }
                
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                //showDbStatus('تم الاتصال بقاعدة البيانات', 'success');
                return true;
            } catch (error) {
                showDbStatus('خطأ في الاتصال بقاعدة البيانات: ' + error.message, 'error');
                return false;
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (initSupabase()) {
                loadApartments();
                document.getElementById('setup-instructions').style.display = 'none';
            }
        });

        // Show database status
        function showDbStatus(message, type = 'info') {
            const alert = document.getElementById('db-status');
            const messageEl = document.getElementById('db-status-message');
            
            alert.className = `alert alert-${type} mb-4`;
            messageEl.textContent = message;
            alert.style.display = 'block';
        }

        // Show status message
        function showStatus(message, type = 'info') {
            const alert = document.getElementById('status-alert');
            const messageEl = document.getElementById('status-message');
            
            alert.className = `alert alert-${type} mb-4`;
            messageEl.textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // Show loading indicator
        function showLoading(show = true) {
            const loading = document.getElementById('loading-indicator');
            loading.classList.toggle('show', show);
        }

        // Database configuration modal functions
        function showDatabaseConfig() {
            document.getElementById('db-config-modal').classList.add('modal-open');
        }

        function closeDbConfig() {
            document.getElementById('db-config-modal').classList.remove('modal-open');
        }

        function testConnection() {
            const url = document.getElementById('supabase-url').value;
            const key = document.getElementById('supabase-key').value;
            
            if (!url || !key) {
                showStatus('يرجى إدخال جميع البيانات', 'error');
                return;
            }

            try {
                const testClient = window.supabase.createClient(url, key);
                showStatus('تم اختبار الاتصال بنجاح! يرجى تحديث الكود بهذه البيانات', 'success');
                closeDbConfig();
            } catch (error) {
                showStatus('فشل في الاتصال: ' + error.message, 'error');
            }
        }

        // Load apartments from Supabase
        async function loadApartments() {
            if (!supabase) return;
            
            showLoading(true);
            try {
                const { data, error } = await supabase
                    .from('apartments')
                    .select('*')
                    .order('apartment_id');

                if (error) throw error;
                
                apartmentsData = data || [];
                updateStats();
                //showStatus('تم تحميل البيانات بنجاح', 'success');
            } catch (error) {
                showStatus('خطأ في تحميل البيانات: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Save apartment to Supabase
        async function saveApartment(apartmentData) {
            if (!supabase) return false;
            
            showLoading(true);
            try {
                // Check if apartment exists
                const { data: existing } = await supabase
                    .from('apartments')
                    .select('id')
                    .eq('apartment_id', apartmentData.apartment_id)
                    .single();

                let result;
                if (existing) {
                    // Update existing apartment
                    result = await supabase
                        .from('apartments')
                        .update(apartmentData)
                        .eq('apartment_id', apartmentData.apartment_id);
                } else {
                    // Insert new apartment
                    result = await supabase
                        .from('apartments')
                        .insert([apartmentData]);
                }

                if (result.error) throw result.error;
                
                await loadApartments(); // Reload data
                return true;
            } catch (error) {
                showStatus('خطأ في حفظ البيانات: ' + error.message, 'error');
                return false;
            } finally {
                showLoading(false);
            }
        }

        // Delete apartment from Supabase
        async function deleteApartment(apartmentId) {
            if (!supabase) return;
            
            if (!confirm('هل أنت متأكد من حذف بيانات هذه الشقة؟')) return;
            
            showLoading(true);
            try {
                const { error } = await supabase
                    .from('apartments')
                    .delete()
                    .eq('apartment_id', apartmentId);

                if (error) throw error;
                
                await loadApartments(); // Reload data
                showStatus('تم حذف بيانات الشقة', 'success');
            } catch (error) {
                showStatus('خطأ في حذف البيانات: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Refresh data from database
        async function refreshData() {
            await loadApartments();
            if (document.getElementById('apartments-list').style.display !== 'none') {
                displayApartments();
            }
        }

        // Update apartment ID and check if exists
        async function updateApartmentId() {
            const floor = document.querySelector('select[name="floor"]').value;
            const apartment = document.querySelector('select[name="apartment"]').value;
            const display = document.getElementById('apartment-id');
            const existingIndicator = document.getElementById('existing-indicator');
            
            if (floor && apartment) {
                const floorIndex = floorMapping[floor];
                const apartmentId = `${floorIndex}-${apartment}`;
                display.textContent = apartmentId;
                
                // Check if apartment exists in loaded data
                const existing = apartmentsData.find(apt => apt.apartment_id === apartmentId);
                if (existing) {
                    existingIndicator.style.display = 'inline';
                    prefillForm(existing);
                } else {
                    existingIndicator.style.display = 'none';
                    clearForm();
                }
            } else {
                display.textContent = 'سيتم تحديده تلقائياً';
                existingIndicator.style.display = 'none';
                clearForm();
            }
        }

        // Pre-fill form with existing data
        function prefillForm(data) {
            const form = document.getElementById('apartment-form');
            Object.keys(data).forEach(key => {
                const input = form.querySelector(`[name="${key}"]`);
                if (input && data[key]) {
                    input.value = data[key];
                }
            });
        }

        // Clear form (except apartment selection)
        function clearForm() {
            const form = document.getElementById('apartment-form');
            const inputs = form.querySelectorAll('input:not([name="floor"]):not([name="apartment"]), textarea, select:not([name="floor"]):not([name="apartment"])');
            inputs.forEach(input => {
                if (input.name !== 'floor' && input.name !== 'apartment') {
                    input.value = '';
                }
            });
        }

        // Handle form submission
        document.getElementById('apartment-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            if (!supabase) {
                showStatus('غير متصل بقاعدة البيانات', 'error');
                return;
            }
            
            const formData = new FormData(event.target);
            const floor = formData.get('floor');
            const apartment = formData.get('apartment');
            
            if (!floor || !apartment) {
                showStatus('يرجى تحديد الطابق ورقم الشقة', 'error');
                return;
            }

            const floorIndex = floorMapping[floor];
            const apartmentId = `${floorIndex}-${apartment}`;

            // Create apartment data object
            const apartmentData = {
                apartment_id: apartmentId,
                floor: floor,
                apartment_number: apartment,
                resident_name: formData.get('resident_name'),
                title: formData.get('title'),
                residence_type: formData.get('residence_type'),
                primary_phone: formData.get('primary_phone'),
                secondary_phone: formData.get('secondary_phone'),
                email: formData.get('email'),
                family_members: parseInt(formData.get('family_members')) || null,
                children_count: parseInt(formData.get('children_count')) || null,
                move_in_date: formData.get('move_in_date') || null,
                emergency_contact_name: formData.get('emergency_contact_name'),
                emergency_contact_phone: formData.get('emergency_contact_phone'),
                notes: formData.get('notes'),
                registration_date: new Date().toISOString().split('T')[0],
                last_updated: new Date().toISOString()
            };

            const success = await saveApartment(apartmentData);
            
            if (success) {
                const isUpdate = document.getElementById('existing-indicator').style.display === 'inline';
                showStatus(isUpdate ? 'تم تحديث بيانات الشقة بنجاح' : 'تم تسجيل الشقة بنجاح', 'success');
                
                // Reset form
                event.target.reset();
                document.getElementById('apartment-id').textContent = 'سيتم تحديده تلقائياً';
                document.getElementById('existing-indicator').style.display = 'none';
            }
        });

        // Update statistics
        function updateStats() {
            const totalApartments = 18; // 6 floors × 3 apartments
            const registeredCount = apartmentsData.length;
            const unregisteredCount = totalApartments - registeredCount;
            
            document.getElementById('total-apartments').textContent = totalApartments;
            document.getElementById('registered-apartments').textContent = registeredCount;
            document.getElementById('unregistered-apartments').textContent = unregisteredCount;
        }

        // Show different sections
        function showRegistrationForm() {
            document.getElementById('registration-form').style.display = 'block';
            document.getElementById('apartments-list').style.display = 'none';
        }

        function showApartmentsList() {
            document.getElementById('registration-form').style.display = 'none';
            document.getElementById('apartments-list').style.display = 'block';
            displayApartments();
        }

        // Display apartments
        function displayApartments() {
            const container = document.getElementById('apartments-container');
            const floorFilter = document.getElementById('floor-filter').value;
            const typeFilter = document.getElementById('type-filter').value;
            
            let html = '';
            
            // Generate all possible apartments
            const floors = ['أرضي', 'أول', 'ثاني', 'ثالث', 'رابع', 'خامس'];
            const apartments = [1, 2, 3];
            
            floors.forEach((floor, floorIndex) => {
                apartments.forEach(aptNum => {
                    const apartmentId = `${floorIndex}-${aptNum}`;
                    const apartment = apartmentsData.find(apt => apt.apartment_id === apartmentId);
                    const isEmpty = !apartment;
                    
                    // Apply filters
                    if (floorFilter && floor !== floorFilter) return;
                    if (typeFilter === 'empty' && !isEmpty) return;
                    if (typeFilter && typeFilter !== 'empty' && (isEmpty || apartment.residence_type !== typeFilter)) return;
                    
                    if (isEmpty) {
                        html += `
                            <div class="card bg-base-200 shadow-md mb-4 opacity-60">
                                <div class="card-body">
                                    <h3 class="font-bold text-lg">${floor} - شقة ${aptNum}</h3>
                                    <p class="text-gray-500">غير مسجلة</p>
                                    <div class="badge badge-warning">فارغة</div>
                                </div>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="card bg-base-200 shadow-md mb-4">
                                <div class="card-body">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                        <div>
                                            <h3 class="font-bold text-lg">${apartment.floor} - شقة ${apartment.apartment_number}</h3>
                                            <p class="text-sm"><strong>الاسم:</strong> ${apartment.title ? apartment.title + ' ' : ''}${apartment.resident_name}</p>
                                            <p class="text-sm"><strong>النوع:</strong> 
                                                <span class="badge ${apartment.residence_type === 'مالك' ? 'badge-success' : 'badge-info'}">${apartment.residence_type}</span>
                                            </p>
                                            <p class="text-sm"><strong>الهاتف:</strong> ${apartment.primary_phone}</p>
                                            ${apartment.email ? `<p class="text-sm"><strong>البريد:</strong> ${apartment.email}</p>` : ''}
                                        </div>
                                        <div>
                                            <p class="text-sm"><strong>أفراد الأسرة:</strong> ${apartment.family_members || 'غير محدد'}</p>
                                            <p class="text-sm"><strong>عدد الأطفال:</strong> ${apartment.children_count || 0}</p>
                                            ${apartment.move_in_date ? `<p class="text-sm"><strong>تاريخ السكن:</strong> ${apartment.move_in_date}</p>` : ''}
                                            <p class="text-sm"><strong>التسجيل:</strong> ${apartment.registration_date}</p>
                                            ${apartment.notes ? `<p class="text-sm"><strong>ملاحظات:</strong> ${apartment.notes}</p>` : ''}
                                        </div>
                                    </div>
                                    
                                    <div class="card-actions justify-end mt-4">
                                        <button class="btn btn-sm btn-outline btn-error" onclick="deleteApartment('${apartmentId}')">
                                            🗑️ حذف
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
            });
            
            container.innerHTML = html || '<div class="alert"><span>لا توجد شقق تطابق المرشح</span></div>';
        }

        // Filter apartments
        function filterApartments() {
            displayApartments();
        }
    </script>

    <!-- Supabase Table Creation SQL -->
    <script type="text/plain" id="sql-schema">
        -- SQL to create the apartments table in Supabase
        -- Run this in your Supabase SQL editor
        
        CREATE TABLE apartments (
            id SERIAL PRIMARY KEY,
            apartment_id TEXT UNIQUE NOT NULL,
            floor TEXT NOT NULL,
            apartment_number TEXT NOT NULL,
            resident_name TEXT NOT NULL,
            title TEXT,
            residence_type TEXT NOT NULL,
            primary_phone TEXT NOT NULL,
            secondary_phone TEXT,
            email TEXT,
            family_members INTEGER,
            children_count INTEGER,
            move_in_date DATE,
            emergency_contact_name TEXT,
            emergency_contact_phone TEXT,
            notes TEXT,
            registration_date DATE DEFAULT CURRENT_DATE,
            last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        );

        -- Create RLS policies (optional, for security)
        ALTER TABLE apartments ENABLE ROW LEVEL SECURITY;
        
        -- Allow public read access
        CREATE POLICY "Allow public read" ON apartments FOR SELECT USING (true);
        
        -- Allow public insert/update (you might want to restrict this)
        CREATE POLICY "Allow public insert" ON apartments FOR INSERT WITH CHECK (true);
        CREATE POLICY "Allow public update" ON apartments FOR UPDATE USING (true);
        CREATE POLICY "Allow public delete" ON apartments FOR DELETE USING (true);
    </script>
</body>
</html>